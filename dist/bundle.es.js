var t=function(t){try{return!!t()}catch(t){return!0}},e={}.toString,n=function(t){return e.call(t).slice(8,-1)},r="".split,o=t((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==n(t)?r.call(t,""):Object(t)}:Object,i=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},c=function(t){return o(i(t))},u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function a(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function s(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}var f,l,p=function(t){return t&&t.Math==Math&&t},h=p("object"==typeof globalThis&&globalThis)||p("object"==typeof window&&window)||p("object"==typeof self&&self)||p("object"==typeof u&&u)||function(){return this}()||Function("return this")(),d=!t((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),v=function(t){return"object"==typeof t?null!==t:"function"==typeof t},y=h.document,m=v(y)&&v(y.createElement),b=function(t){return m?y.createElement(t):{}},g=!d&&!t((function(){return 7!=Object.defineProperty(b("div"),"a",{get:function(){return 7}}).a})),w=function(t){if(!v(t))throw TypeError(String(t)+" is not an object");return t},O=function(t,e){if(!v(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!v(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!v(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!v(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},j=Object.defineProperty,T={f:d?j:function(t,e,n){if(w(t),e=O(e,!0),w(n),g)try{return j(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},S=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},k=d?function(t,e,n){return T.f(t,e,S(1,n))}:function(t,e,n){return t[e]=n,t},P=function(t,e){try{k(h,t,e)}catch(n){h[t]=e}return e},x=h["__core-js_shared__"]||P("__core-js_shared__",{}),E=s((function(t){(t.exports=function(t,e){return x[t]||(x[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.9.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})})),L={}.hasOwnProperty,_=function(t,e){return L.call(t,e)},I=0,A=Math.random(),M=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++I+A).toString(36)},R="process"==n(h.process),D=h,q=function(t){return"function"==typeof t?t:void 0},C=function(t,e){return arguments.length<2?q(D[t])||q(h[t]):D[t]&&D[t][e]||h[t]&&h[t][e]},F=C("navigator","userAgent")||"",N=h.process,G=N&&N.versions,V=G&&G.v8;V?l=(f=V.split("."))[0]+f[1]:F&&(!(f=F.match(/Edge\/(\d+)/))||f[1]>=74)&&(f=F.match(/Chrome\/(\d+)/))&&(l=f[1]);var U,z=l&&+l,H=!!Object.getOwnPropertySymbols&&!t((function(){return!Symbol.sham&&(R?38===z:z>37&&z<41)})),K=H&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,W=E("wks"),B=h.Symbol,Y=K?B:B&&B.withoutSetter||M,X=function(t){return _(W,t)&&(H||"string"==typeof W[t])||(H&&_(B,t)?W[t]=B[t]:W[t]=Y("Symbol."+t)),W[t]},J=Math.ceil,Q=Math.floor,Z=function(t){return isNaN(t=+t)?0:(t>0?Q:J)(t)},$=Math.min,tt=function(t){return t>0?$(Z(t),9007199254740991):0},et=Math.max,nt=Math.min,rt=function(t){return function(e,n,r){var o,i=c(e),u=tt(i.length),a=function(t,e){var n=Z(t);return n<0?et(n+e,0):nt(n,e)}(r,u);if(t&&n!=n){for(;u>a;)if((o=i[a++])!=o)return!0}else for(;u>a;a++)if((t||a in i)&&i[a]===n)return t||a||0;return!t&&-1}},ot={includes:rt(!0),indexOf:rt(!1)},it={},ct=ot.indexOf,ut=function(t,e){var n,r=c(t),o=0,i=[];for(n in r)!_(it,n)&&_(r,n)&&i.push(n);for(;e.length>o;)_(r,n=e[o++])&&(~ct(i,n)||i.push(n));return i},at=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],st=Object.keys||function(t){return ut(t,at)},ft=d?Object.defineProperties:function(t,e){w(t);for(var n,r=st(e),o=r.length,i=0;o>i;)T.f(t,n=r[i++],e[n]);return t},lt=C("document","documentElement"),pt=E("keys"),ht=function(t){return pt[t]||(pt[t]=M(t))},dt=ht("IE_PROTO"),vt=function(){},yt=function(t){return"<script>"+t+"<\/script>"},mt=function(){try{U=document.domain&&new ActiveXObject("htmlfile")}catch(t){}var t,e;mt=U?function(t){t.write(yt("")),t.close();var e=t.parentWindow.Object;return t=null,e}(U):((e=b("iframe")).style.display="none",lt.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(yt("document.F=Object")),t.close(),t.F);for(var n=at.length;n--;)delete mt.prototype[at[n]];return mt()};it[dt]=!0;var bt=Object.create||function(t,e){var n;return null!==t?(vt.prototype=w(t),n=new vt,vt.prototype=null,n[dt]=t):n=mt(),void 0===e?n:ft(n,e)},gt=X("unscopables"),wt=Array.prototype;null==wt[gt]&&T.f(wt,gt,{configurable:!0,value:bt(null)});var Ot=function(t){wt[gt][t]=!0},jt={},Tt=Function.toString;"function"!=typeof x.inspectSource&&(x.inspectSource=function(t){return Tt.call(t)});var St,kt,Pt,xt=x.inspectSource,Et=h.WeakMap,Lt="function"==typeof Et&&/native code/.test(xt(Et)),_t=h.WeakMap;if(Lt){var It=x.state||(x.state=new _t),At=It.get,Mt=It.has,Rt=It.set;St=function(t,e){return e.facade=t,Rt.call(It,t,e),e},kt=function(t){return At.call(It,t)||{}},Pt=function(t){return Mt.call(It,t)}}else{var Dt=ht("state");it[Dt]=!0,St=function(t,e){return e.facade=t,k(t,Dt,e),e},kt=function(t){return _(t,Dt)?t[Dt]:{}},Pt=function(t){return _(t,Dt)}}var qt,Ct,Ft,Nt={set:St,get:kt,has:Pt,enforce:function(t){return Pt(t)?kt(t):St(t,{})},getterFor:function(t){return function(e){var n;if(!v(e)||(n=kt(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},Gt={}.propertyIsEnumerable,Vt=Object.getOwnPropertyDescriptor,Ut={f:Vt&&!Gt.call({1:2},1)?function(t){var e=Vt(this,t);return!!e&&e.enumerable}:Gt},zt=Object.getOwnPropertyDescriptor,Ht={f:d?zt:function(t,e){if(t=c(t),e=O(e,!0),g)try{return zt(t,e)}catch(t){}if(_(t,e))return S(!Ut.f.call(t,e),t[e])}},Kt=s((function(t){var e=Nt.get,n=Nt.enforce,r=String(String).split("String");(t.exports=function(t,e,o,i){var c,u=!!i&&!!i.unsafe,a=!!i&&!!i.enumerable,s=!!i&&!!i.noTargetGet;"function"==typeof o&&("string"!=typeof e||_(o,"name")||k(o,"name",e),(c=n(o)).source||(c.source=r.join("string"==typeof e?e:""))),t!==h?(u?!s&&t[e]&&(a=!0):delete t[e],a?t[e]=o:k(t,e,o)):a?t[e]=o:P(e,o)})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||xt(this)}))})),Wt=at.concat("length","prototype"),Bt={f:Object.getOwnPropertyNames||function(t){return ut(t,Wt)}},Yt={f:Object.getOwnPropertySymbols},Xt=C("Reflect","ownKeys")||function(t){var e=Bt.f(w(t)),n=Yt.f;return n?e.concat(n(t)):e},Jt=function(t,e){for(var n=Xt(e),r=T.f,o=Ht.f,i=0;i<n.length;i++){var c=n[i];_(t,c)||r(t,c,o(e,c))}},Qt=/#|\.prototype\./,Zt=function(e,n){var r=te[$t(e)];return r==ne||r!=ee&&("function"==typeof n?t(n):!!n)},$t=Zt.normalize=function(t){return String(t).replace(Qt,".").toLowerCase()},te=Zt.data={},ee=Zt.NATIVE="N",ne=Zt.POLYFILL="P",re=Zt,oe=Ht.f,ie=function(t,e){var n,r,o,i,c,u=t.target,a=t.global,s=t.stat;if(n=a?h:s?h[u]||P(u,{}):(h[u]||{}).prototype)for(r in e){if(i=e[r],o=t.noTargetGet?(c=oe(n,r))&&c.value:n[r],!re(a?r:u+(s?".":"#")+r,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Jt(i,o)}(t.sham||o&&o.sham)&&k(i,"sham",!0),Kt(n,r,i,t)}},ce=function(t){return Object(i(t))},ue=!t((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),ae=ht("IE_PROTO"),se=Object.prototype,fe=ue?Object.getPrototypeOf:function(t){return t=ce(t),_(t,ae)?t[ae]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?se:null},le=X("iterator"),pe=!1;[].keys&&("next"in(Ft=[].keys())?(Ct=fe(fe(Ft)))!==Object.prototype&&(qt=Ct):pe=!0),(null==qt||t((function(){var t={};return qt[le].call(t)!==t})))&&(qt={}),_(qt,le)||k(qt,le,(function(){return this}));var he={IteratorPrototype:qt,BUGGY_SAFARI_ITERATORS:pe},de=T.f,ve=X("toStringTag"),ye=function(t,e,n){t&&!_(t=n?t:t.prototype,ve)&&de(t,ve,{configurable:!0,value:e})},me=he.IteratorPrototype,be=function(){return this},ge=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return w(n),function(t){if(!v(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype")}(r),e?t.call(n,r):n.__proto__=r,n}}():void 0),we=he.IteratorPrototype,Oe=he.BUGGY_SAFARI_ITERATORS,je=X("iterator"),Te=function(){return this},Se=Nt.set,ke=Nt.getterFor("Array Iterator"),Pe=function(t,e,n,r,o,i,c){!function(t,e,n){var r=e+" Iterator";t.prototype=bt(me,{next:S(1,n)}),ye(t,r,!1),jt[r]=be}(n,e,r);var u,a,s,f=function(t){if(t===o&&v)return v;if(!Oe&&t in h)return h[t];switch(t){case"keys":case"values":case"entries":return function(){return new n(this,t)}}return function(){return new n(this)}},l=e+" Iterator",p=!1,h=t.prototype,d=h[je]||h["@@iterator"]||o&&h[o],v=!Oe&&d||f(o),y="Array"==e&&h.entries||d;if(y&&(u=fe(y.call(new t)),we!==Object.prototype&&u.next&&(fe(u)!==we&&(ge?ge(u,we):"function"!=typeof u[je]&&k(u,je,Te)),ye(u,l,!0))),"values"==o&&d&&"values"!==d.name&&(p=!0,v=function(){return d.call(this)}),h[je]!==v&&k(h,je,v),jt[e]=v,o)if(a={values:f("values"),keys:i?v:f("keys"),entries:f("entries")},c)for(s in a)(Oe||p||!(s in h))&&Kt(h,s,a[s]);else ie({target:e,proto:!0,forced:Oe||p},a);return a}(Array,"Array",(function(t,e){Se(this,{type:"Array Iterator",target:c(t),index:0,kind:e})}),(function(){var t=ke(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values");jt.Arguments=jt.Array,Ot("keys"),Ot("values"),Ot("entries");var xe={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Ee=X("iterator"),Le=X("toStringTag"),_e=Pe.values;for(var Ie in xe){var Ae=h[Ie],Me=Ae&&Ae.prototype;if(Me){if(Me[Ee]!==_e)try{k(Me,Ee,_e)}catch(t){Me[Ee]=_e}if(Me[Le]||k(Me,Le,Ie),xe[Ie])for(var Re in Pe)if(Me[Re]!==Pe[Re])try{k(Me,Re,Pe[Re])}catch(t){Me[Re]=Pe[Re]}}}var De=[];class qe{static loop(t){for(var e of De)e(t);qe.requestId=requestAnimationFrame(qe.loop)}static start(){qe.requestId=requestAnimationFrame(qe.loop)}static subscribe(t){De.push(t)}static checkId(t){return De.every(e=>e.id!==t)}static unsubscribe(t){var e=De.findIndex(e=>e.id===t);-1!==e&&De.splice(e,1)}}qe.start();var Ce=a(s((function(t){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},t.exports.default=t.exports,t.exports.__esModule=!0})));function Fe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ne(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Fe(Object(n),!0).forEach((function(e){Ce(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Fe(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class Ge{constructor(t){if("object"==typeof t){var{frequency:e,run:n}=t;this.frequency=e||0,this.task=n}else"function"==typeof t&&(this.frequency=0,this.task=t);this.count=0}run(t){t.currentTime>=this.frequency*this.count&&(this.count++,this.task(Ne(Ne({},t),{},{count:this.count})))}}var Ve=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Ue=[],ze=Ue.sort,He=t((function(){Ue.sort(void 0)})),Ke=t((function(){Ue.sort(null)})),We=function(e,n){var r=[][e];return!!r&&t((function(){r.call(null,n||function(){throw 1},1)}))}("sort");ie({target:"Array",proto:!0,forced:He||!Ke||!We},{sort:function(t){return void 0===t?ze.call(ce(this)):ze.call(ce(this),Ve(t))}});class Be{constructor(){this.list=[],this.index=0}add(t){this.list.push(t),this.list.sort((t,e)=>t.timestamp<e.timestamp?-1:t.timestamp>e.timestamp?1:0)}remove(t){var e=this.list.map(t=>t.id).indexOf(t);this.list.splice(e,0),this.index--}compare(t){this.list[this.index]&&this.list[this.index].currentTime<=t.currentTime&&(this.list[this.index].run(t),this.index++)}}var Ye=a(s((function(t){function e(t,e,n,r,o,i,c){try{var u=t[i](c),a=u.value}catch(t){return void n(t)}u.done?e(a):Promise.resolve(a).then(r,o)}t.exports=function(t){return function(){var n=this,r=arguments;return new Promise((function(o,i){var c=t.apply(n,r);function u(t){e(c,o,i,u,a,"next",t)}function a(t){e(c,o,i,u,a,"throw",t)}u(void 0)}))}},t.exports.default=t.exports,t.exports.__esModule=!0}))),Xe=h.Promise,Je=X("species"),Qe=X("iterator"),Ze=Array.prototype,$e=function(t,e,n){if(Ve(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}},tn={};tn[X("toStringTag")]="z";var en="[object z]"===String(tn),nn=X("toStringTag"),rn="Arguments"==n(function(){return arguments}()),on=en?n:function(t){var e,r,o;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),nn))?r:rn?n(e):"Object"==(o=n(e))&&"function"==typeof e.callee?"Arguments":o},cn=X("iterator"),un=function(t){var e=t.return;if(void 0!==e)return w(e.call(t)).value},an=function(t,e){this.stopped=t,this.result=e},sn=function(t,e,n){var r,o,i,c,u,a,s,f,l=n&&n.that,p=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_ITERATOR),d=!(!n||!n.INTERRUPTED),v=$e(e,l,1+p+d),y=function(t){return r&&un(r),new an(!0,t)},m=function(t){return p?(w(t),d?v(t[0],t[1],y):v(t[0],t[1])):d?v(t,y):v(t)};if(h)r=t;else{if("function"!=typeof(o=function(t){if(null!=t)return t[cn]||t["@@iterator"]||jt[on(t)]}(t)))throw TypeError("Target is not iterable");if(void 0!==(f=o)&&(jt.Array===f||Ze[Qe]===f)){for(i=0,c=tt(t.length);c>i;i++)if((u=m(t[i]))&&u instanceof an)return u;return new an(!1)}r=o.call(t)}for(a=r.next;!(s=a.call(r)).done;){try{u=m(s.value)}catch(t){throw un(r),t}if("object"==typeof u&&u&&u instanceof an)return u}return new an(!1)},fn=X("iterator"),ln=!1;try{var pn=0,hn={next:function(){return{done:!!pn++}},return:function(){ln=!0}};hn[fn]=function(){return this},Array.from(hn,(function(){throw 2}))}catch(t){}var dn,vn,yn,mn=X("species"),bn=/(iphone|ipod|ipad).*applewebkit/i.test(F),gn=h.location,wn=h.setImmediate,On=h.clearImmediate,jn=h.process,Tn=h.MessageChannel,Sn=h.Dispatch,kn=0,Pn={},xn=function(t){if(Pn.hasOwnProperty(t)){var e=Pn[t];delete Pn[t],e()}},En=function(t){return function(){xn(t)}},Ln=function(t){xn(t.data)},_n=function(t){h.postMessage(t+"",gn.protocol+"//"+gn.host)};wn&&On||(wn=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return Pn[++kn]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},dn(kn),kn},On=function(t){delete Pn[t]},R?dn=function(t){jn.nextTick(En(t))}:Sn&&Sn.now?dn=function(t){Sn.now(En(t))}:Tn&&!bn?(yn=(vn=new Tn).port2,vn.port1.onmessage=Ln,dn=$e(yn.postMessage,yn,1)):h.addEventListener&&"function"==typeof postMessage&&!h.importScripts&&gn&&"file:"!==gn.protocol&&!t(_n)?(dn=_n,h.addEventListener("message",Ln,!1)):dn="onreadystatechange"in b("script")?function(t){lt.appendChild(b("script")).onreadystatechange=function(){lt.removeChild(this),xn(t)}}:function(t){setTimeout(En(t),0)});var In,An,Mn,Rn,Dn,qn,Cn,Fn,Nn={set:wn,clear:On},Gn=/web0s(?!.*chrome)/i.test(F),Vn=Ht.f,Un=Nn.set,zn=h.MutationObserver||h.WebKitMutationObserver,Hn=h.document,Kn=h.process,Wn=h.Promise,Bn=Vn(h,"queueMicrotask"),Yn=Bn&&Bn.value;Yn||(In=function(){var t,e;for(R&&(t=Kn.domain)&&t.exit();An;){e=An.fn,An=An.next;try{e()}catch(t){throw An?Rn():Mn=void 0,t}}Mn=void 0,t&&t.enter()},bn||R||Gn||!zn||!Hn?Wn&&Wn.resolve?(Cn=Wn.resolve(void 0),Fn=Cn.then,Rn=function(){Fn.call(Cn,In)}):Rn=R?function(){Kn.nextTick(In)}:function(){Un.call(h,In)}:(Dn=!0,qn=Hn.createTextNode(""),new zn(In).observe(qn,{characterData:!0}),Rn=function(){qn.data=Dn=!Dn}));var Xn,Jn,Qn,Zn,$n=Yn||function(t){var e={fn:t,next:void 0};Mn&&(Mn.next=e),An||(An=e,Rn()),Mn=e},tr=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=Ve(e),this.reject=Ve(n)},er={f:function(t){return new tr(t)}},nr=function(t,e){if(w(t),v(e)&&e.constructor===t)return e;var n=er.f(t);return(0,n.resolve)(e),n.promise},rr=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},or=Nn.set,ir=X("species"),cr="Promise",ur=Nt.get,ar=Nt.set,sr=Nt.getterFor(cr),fr=Xe,lr=h.TypeError,pr=h.document,hr=h.process,dr=C("fetch"),vr=er.f,yr=vr,mr=!!(pr&&pr.createEvent&&h.dispatchEvent),br="function"==typeof PromiseRejectionEvent,gr=re(cr,(function(){if(!(xt(fr)!==String(fr))){if(66===z)return!0;if(!R&&!br)return!0}if(z>=51&&/native code/.test(fr))return!1;var t=fr.resolve(1),e=function(t){t((function(){}),(function(){}))};return(t.constructor={})[ir]=e,!(t.then((function(){}))instanceof e)})),wr=gr||!function(t,e){if(!e&&!ln)return!1;var n=!1;try{var r={};r[fn]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n}((function(t){fr.all(t).catch((function(){}))})),Or=function(t){var e;return!(!v(t)||"function"!=typeof(e=t.then))&&e},jr=function(t,e){if(!t.notified){t.notified=!0;var n=t.reactions;$n((function(){for(var r=t.value,o=1==t.state,i=0;n.length>i;){var c,u,a,s=n[i++],f=o?s.ok:s.fail,l=s.resolve,p=s.reject,h=s.domain;try{f?(o||(2===t.rejection&&Pr(t),t.rejection=1),!0===f?c=r:(h&&h.enter(),c=f(r),h&&(h.exit(),a=!0)),c===s.promise?p(lr("Promise-chain cycle")):(u=Or(c))?u.call(c,l,p):l(c)):p(r)}catch(t){h&&!a&&h.exit(),p(t)}}t.reactions=[],t.notified=!1,e&&!t.rejection&&Sr(t)}))}},Tr=function(t,e,n){var r,o;mr?((r=pr.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),h.dispatchEvent(r)):r={promise:e,reason:n},!br&&(o=h["on"+t])?o(r):"unhandledrejection"===t&&function(t,e){var n=h.console;n&&n.error&&(1===arguments.length?n.error(t):n.error(t,e))}("Unhandled promise rejection",n)},Sr=function(t){or.call(h,(function(){var e,n=t.facade,r=t.value;if(kr(t)&&(e=rr((function(){R?hr.emit("unhandledRejection",r,n):Tr("unhandledrejection",n,r)})),t.rejection=R||kr(t)?2:1,e.error))throw e.value}))},kr=function(t){return 1!==t.rejection&&!t.parent},Pr=function(t){or.call(h,(function(){var e=t.facade;R?hr.emit("rejectionHandled",e):Tr("rejectionhandled",e,t.value)}))},xr=function(t,e,n){return function(r){t(e,r,n)}},Er=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,jr(t,!0))},Lr=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw lr("Promise can't be resolved itself");var r=Or(e);r?$n((function(){var n={done:!1};try{r.call(e,xr(Lr,n,t),xr(Er,n,t))}catch(e){Er(n,e,t)}})):(t.value=e,t.state=1,jr(t,!1))}catch(e){Er({done:!1},e,t)}}};gr&&(fr=function(t){!function(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation")}(this,fr,cr),Ve(t),Xn.call(this);var e=ur(this);try{t(xr(Lr,e),xr(Er,e))}catch(t){Er(e,t)}},(Xn=function(t){ar(this,{type:cr,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=function(t,e,n){for(var r in e)Kt(t,r,e[r],n);return t}(fr.prototype,{then:function(t,e){var n,r,o,i=sr(this),c=vr((n=fr,void 0===(o=w(this).constructor)||null==(r=w(o)[mn])?n:Ve(r)));return c.ok="function"!=typeof t||t,c.fail="function"==typeof e&&e,c.domain=R?hr.domain:void 0,i.parent=!0,i.reactions.push(c),0!=i.state&&jr(i,!1),c.promise},catch:function(t){return this.then(void 0,t)}}),Jn=function(){var t=new Xn,e=ur(t);this.promise=t,this.resolve=xr(Lr,e),this.reject=xr(Er,e)},er.f=vr=function(t){return t===fr||t===Qn?new Jn(t):yr(t)},"function"==typeof Xe&&(Zn=Xe.prototype.then,Kt(Xe.prototype,"then",(function(t,e){var n=this;return new fr((function(t,e){Zn.call(n,t,e)})).then(t,e)}),{unsafe:!0}),"function"==typeof dr&&ie({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return nr(fr,dr.apply(h,arguments))}}))),ie({global:!0,wrap:!0,forced:gr},{Promise:fr}),ye(fr,cr,!1),function(t){var e=C(t),n=T.f;d&&e&&!e[Je]&&n(e,Je,{configurable:!0,get:function(){return this}})}(cr),Qn=C(cr),ie({target:cr,stat:!0,forced:gr},{reject:function(t){var e=vr(this);return e.reject.call(void 0,t),e.promise}}),ie({target:cr,stat:!0,forced:gr},{resolve:function(t){return nr(this,t)}}),ie({target:cr,stat:!0,forced:wr},{all:function(t){var e=this,n=vr(e),r=n.resolve,o=n.reject,i=rr((function(){var n=Ve(e.resolve),i=[],c=0,u=1;sn(t,(function(t){var a=c++,s=!1;i.push(void 0),u++,n.call(e,t).then((function(t){s||(s=!0,i[a]=t,--u||r(i))}),o)})),--u||r(i)}));return i.error&&o(i.value),n.promise},race:function(t){var e=this,n=vr(e),r=n.reject,o=rr((function(){var o=Ve(e.resolve);sn(t,(function(t){o.call(e,t).then(n.resolve,r)}))}));return o.error&&r(o.value),n.promise}});class _r{constructor(t){this.context=t,this.link=null}add(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>null,n=this.link;return this.link=new Promise(function(){var r=Ye((function*(r,o){yield n,yield new Promise(t).then(t=>{e(t),r()}).catch(t=>{console.error("Missing resolve in the request function."),e(t),o()})}));return function(t,e){return r.apply(this,arguments)}}()),this.context}}class Ir{constructor(t){this.context=t,this.temp=null,this.key=null,this.initial=0,this.timestamp=0}compare(t){this.key&&(null===this.temp&&(this.temp=t.currentTime+this.key.delay),null!==this.temp&&this.temp<=t.currentTime&&(this.key.callback(t),this.key=null,this.temp=null))}}class Ar{constructor(t){var{currentTime:e,globalTime:n}=t;this.currentTime=e,this.globalTime=n}}export default class{constructor(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{id:e,ratio:n,task:r}=t;this.id=(t=>t?qe.checkId(t)?t:(console.error('ERROR: The "'.concat(t,'" id has already been defined. (Timeline Library)')),Date.now()):Date.now())(e),this.ratio=n||1,this.task=r?new Ge(r):null,this.keytime=new Be,this.chain=new _r(this),this.util=new Ir(this),this.bank=0,this.initial=0,this.current=0,this.state="stop",qe.subscribe(this.consume.bind(this))}consume(t){this.controller(t);var e=new Ar({currentTime:this.current,globalTime:t});this.util.compare(e),this.keytime.compare(e)}setId(t){t?qe.checkId(t)?this.id=t:console.error('ERROR: The "'.concat(t,'" id has already been defined. (Timeline Library)')):console.error("ERROR: Please specify an id. (Timeline Library)")}setRatio(t){this.ratio=t}setTask(t){this.task=new Ge(t)}addKeytime(t){this.keytime.add(t)}removeKeytime(t){this.keytime.remove(t)}listKeytimes(){return this.keytime.list}controller(t){switch(this.initial||(this.initial=t),this.state){case"start":this.bank&&(this.initial+=this.bank,this.bank=null),this.current=(t-this.initial)*this.ratio,this.task&&this.task.run(new Ar({currentTime:this.current,globalTime:t}));break;case"stop":this.bank=(t-this.initial-this.current)*this.ratio;break;case"reset":this.state="stop",this.initial=0,this.current=0;break;default:console.error("Undefined state.")}}request(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return this.chain.add(((n,r)=>{this.util.key={delay:e,callback:e=>{this.state=t,n()}}}).bind(this),n)}start(t,e){return this.request("start",t,e)}stop(t,e){return this.request("stop",t,e)}reset(t,e){return this.request("reset",t,e)}delete(){qe.unsubscribe(this.id)}}
