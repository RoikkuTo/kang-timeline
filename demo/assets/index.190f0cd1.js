import{R as t,E as e,a as s}from"./vendor.462e4d9e.js";const i=({opts:s})=>{const[i,n]=e.exports.useState(0),r=e.exports.useCallback((()=>{Array.isArray(s)?(s[i].callback(),s.length>1&&n((t=>t?0:1))):s.callback()}),[i,s]);return t.createElement("div",{className:`button simple ${Array.isArray(s)?s[i].className:s.className}`,onClick:r},t.createElement("img",{src:Array.isArray(s)?s[i].icon:s.icon,alt:""}))},n=({timeline:s})=>{const i=e.exports.useCallback((t=>{s.speed=Number(t.target.value)}),[]);return t.createElement("div",{className:"button speed"},t.createElement("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAQCAYAAADwMZRfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAHnSURBVHgBrVO9TgJBEL49OUAE/yrEYEwoLLAiASQRAiR0BJBCKhpfANHQWJioBSCGhIqfIB0NFmBB6zMY8Q30Gjo0sYG7c0Z3yUIo2WSyuzNz33z3zawgLGERdtA0TYRthV3BFEKIxsUJzWc5GFfxIHIJUiqV8ni93pdyubwDdx318wCrfr//NhAI3MBZz+JTFmAmj8czcLlcmtvtHtTr9T3wSZgItgJmDoVC9xhHSyQSPsr+nwmlr0aj0TOdTicrinLYbDb7jUYDGRnATOFw+Ho0GuUw2WazZbrd7iv9TuDZIP31UqnkA0afWA32906ncxCJRB44BueYR9mRGWEZEFbN5/POXq/3NJlMdkVR/FZV1YJxu91+Af5HOP6AqBNh0aL/jzps1Wq1AGjzxRgkk8k78G9jfP47cREWGlRMgDYW5pRl+aTVam0i+5muLADBGTCCiFfD4TCLDofDUZAkSR6Px05g91ypVKwC1/4ZEBSKAky7AACXIGzlFBbrWrvd7sMc/QEJC/QwBIPBAtMgHo9nwbcBZpzvGmj1lsvlrPPDRniQWCyWgbuFtp2w9heLxSMA+AC2JRxONmw8EHbFnE6nj2Ff47vAAZmr1eo+nRM9i/MPkH9cGsyBMleEUA3RVJqjCstavzwRO/5lMCdRAAAAAElFTkSuQmCC",alt:""}),t.createElement("input",{type:"number",className:"valSpeed",step:"0.1",min:"0",defaultValue:"1.0",onChange:i,onBlur:t=>console.log(t.target.value)}))},r=({timestamp:s})=>{const i=e.exports.useRef(!1),n=e.exports.useRef(0),r=e.exports.useCallback((t=>{const e=new Date(t).toJSON(),s=/.*T(.*)Z/.exec(e);return(null==s?void 0:s[1].split(":"))||["--","--","--"]}),[]),a=e.exports.useCallback((()=>{i.current=!i.current,n.current=s}),[s]),l=r(i.current?n.current:s);return t.createElement("div",{className:"timestamp",onClick:a},t.createElement("div",null,t.createElement("span",null,l[0]),t.createElement("span",{className:"column"},":"),t.createElement("span",null,l[1]),t.createElement("span",{className:"column"},":"),t.createElement("span",null,l[2])))},a=({state:e,timeline:s})=>t.createElement("div",{className:"buttons"},t.createElement("div",{className:"left-btns"},t.createElement(i,{opts:[{className:"stop",icon:"/assets/stop.515d3f71.svg",callback:()=>s.stop()},{className:"start",icon:"/assets/start.70e39199.svg",callback:()=>s.start()}]}),t.createElement(i,{opts:{className:"restart",icon:"/assets/restart_png_2.4fe47cb0.png",callback:()=>s.reset()[s.state](0,(()=>e[1](0)))}}),t.createElement(n,{timeline:s})),t.createElement(r,{timestamp:e[0]}),t.createElement(i,{opts:{className:"delete",icon:"/assets/delete_cross.c9c00841.svg",callback:()=>console.log("delete (placeholder)")}}));const l=({ratio:e})=>t.createElement("div",{className:"track"},t.createElement("div",{className:"runnable",style:{width:100*e+"%"}})),c=({state:s,timeline:i})=>{const[n]=s,r=e.exports.useRef(null),a=e.exports.useRef(!1),c=e.exports.useRef("stop"),[o,u]=e.exports.useState(0),m=e.exports.useCallback((t=>{if(r.current){const e=r.current.getBoundingClientRect(),s=t.clientX,i=Number((s-e.x)/e.width);i>=0&&i<=1&&u(i)}}),[]),h=e.exports.useCallback((t=>{i.stop(),c.current=i.state,a.current=!0,m(t)}),[]);return e.exports.useEffect((()=>(window.onmousemove=t=>{a.current&&m(t)},()=>{window.onmousemove=null})),[]),e.exports.useEffect((()=>(window.onmouseup=()=>{a.current&&(a.current=!1,i[c.current](),i.setTimestamp(Math.round(o*i.max)))},()=>{window.onmouseup=null})),[o]),t.createElement("div",{ref:r,className:"range",onMouseDown:h},t.createElement(l,{ratio:a.current?o:n/i.max}))};let o=[];class u{static loop(t){for(const e of o)e.consume(t);u.requestId=requestAnimationFrame(u.loop)}static start(){u.requestId=requestAnimationFrame(u.loop)}static stop(){cancelAnimationFrame(u.requestId)}static subscribe(t){o.push(t)}static checkId(t){return o.every((e=>e.id!==t))}static unsubscribe(t){const e=o.findIndex((e=>e.id===t));-1!==e&&o.splice(e,1)}}u.start();class m{constructor(t){if(this.frequency=1,this.task=()=>null,this.count=0,"object"==typeof t){const{frequency:e,run:s}=t;this.frequency=e||1,this.task=s}else"function"==typeof t&&(this.task=t)}run(t){this.task&&t.currentTime%this.frequency>0&&(this.count++,this.task(Object.assign(Object.assign({},t),{count:this.count})))}}class h{constructor(){this.list=[],this.index=0}add(t){this.list.push(Object.assign({id:Math.random()+Date.now()},t)),this.list.sort(((t,e)=>t.timestamp<e.timestamp?-1:t.timestamp>e.timestamp?1:0))}remove(t){const e=this.list.map((t=>t.id)).indexOf(t);this.list.splice(e,0),this.index--}compare(t){this.list[this.index]&&this.list[this.index].timestamp<=t.currentTime&&(this.list[this.index].task(t),this.index++)}}var d=function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function a(t){try{c(i.next(t))}catch(e){r(e)}}function l(t){try{c(i.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,l)}c((i=i.apply(t,e||[])).next())}))};class p{constructor(t){this.link=null,this.context=t}add(t,e=(()=>null)){const s=this.link;return this.link=new Promise((function(i,n){return d(this,void 0,void 0,(function*(){yield s,yield new Promise(t).then((()=>{e(),i(null)})).catch((()=>{console.error("Missing resolve in the request function."),e(),n()}))}))})),this.context}}class A{constructor(t){this.temp=null,this.keytime=null,this.timestamp=0,this.context=t}compare(t){this.keytime&&(null===this.temp&&(this.temp=t.globalTime+this.keytime.delay),null!==this.temp&&this.temp<=t.globalTime&&(this.keytime.callback(t),this.keytime=null,this.temp=null))}}class b{constructor(t,e){this.currentTime=t,this.globalTime=e}}class k{constructor({id:t,speed:e,task:s,loop:i,range:n}={}){var r;this._id=Date.now(),this._range=null,this._state="stop",this.taskObj=null,this.bank=null,this.initial=0,this.current=0,this._min=0,this._max=null,t&&(this.id=t),this.speed=e||1,s&&(this.task=s),n&&(this.range=n),this.loop=!!i,this.userKeytimes=new h,this.chain=new p(this),this.utilKeytimes=new A(this),Array.isArray(this._range)&&(this.current=null===(r=this._range)||void 0===r?void 0:r[0]),u.subscribe(this)}get id(){return this._id}set id(t){u.checkId(t)?this._id=t:console.error(`ERROR: The "${t}" id has already been defined. (Timeline Library)`)}get task(){return this._task}set task(t){this._task=t,this.taskObj=t?new m(t):null}get range(){return this._range}set range(t){var e,s;this._range=t,this._min=Array.isArray(this._range)?null===(e=this._range)||void 0===e?void 0:e[0]:0,this._max=Array.isArray(this._range)?null===(s=this._range)||void 0===s?void 0:s[1]:this._range}get min(){return this._min}get max(){return this._max}get state(){return this._state}consume(t){this.controller(t);const e=new b(this.current,t);this.utilKeytimes.compare(e),this.userKeytimes.compare(e)}controller(t){var e;switch(this.initial||(this.initial=t),this._state){case"start":this.bank&&(this.initial+=this.bank,this.bank=null),this.current=(t-this.initial)*this.speed,this.taskObj&&this.taskObj.run(new b(this.current,t)),this._range&&(Array.isArray(this._range)&&(null===(e=this._range)||void 0===e?void 0:e[1])<=this.current||this._range<=this.current)&&(this.loop?this.reset().start():this.stop());break;case"stop":this.bank=(t-this.initial-this.current)*this.speed;break;case"reset":this._state="stop",this.current=0,this.initial=0,this.bank=null,this.taskObj&&(this.taskObj.count=0);break;default:console.error("Undefined state.")}}request(t,e=0,s){return this.chain.add(((s,i)=>{this.utilKeytimes.keytime={id:Date.now(),delay:e,callback:e=>{this._state=t,s(null)}}}).bind(this),s)}start(t,e){return this.request("start",t,e)}stop(t,e){return this.request("stop",t,e)}reset(t,e){return this.request("reset",t,e)}delete(){u.unsubscribe(this._id)}setTimestamp(t){this.current-=this.current-t}addKeytime(t){this.userKeytimes.add(t)}removeKeytime(t){this.userKeytimes.remove(t)}listKeytimes(){return this.userKeytimes.list}}const g=({opts:s})=>{const[i,n]=e.exports.useState(0),r=e.exports.useRef(new k(s||{range:6e4,loop:!0}));return e.exports.useEffect((()=>(r.current.task={frequency:100,run:({currentTime:t})=>n(t)},r.current.start(),()=>{r.current.delete()})),[]),t.createElement("div",{className:"timeline"},t.createElement(a,{state:[i,n],timeline:r.current}),t.createElement(c,{state:[i,n],timeline:r.current}))};function y(){return t.createElement("div",{className:"App"},t.createElement(g,null))}s.render(t.createElement(y,null),document.getElementById("root"));
